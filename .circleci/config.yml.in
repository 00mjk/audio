version: 2.1

jobs:
  circleci_consistency:
    docker:
      - image: circleci/python:3.7
    steps:
      - checkout
      - run:
          command: |
            pip install --user --progress-bar off jinja2
            python .circleci/regenerate.py
            git diff --exit-code || (echo ".circleci/config.yml not in sync with config.yml.in! Run .circleci/regenerate.py to update config"; exit 1)

  gpu_smoketest:
    docker:
      - image: nvidia/cuda:10.1-cudnn7-runtime
    resource_class: gpu.medium
    steps:
      - run: nvidia-smi

workflows:
  build:
    jobs:
      - circleci_consistency
      - gpu_smoketest
